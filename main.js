(()=>{"use strict";var e=document.querySelectorAll(".popup"),t=document.querySelector(".popup_profile-edit"),n=document.forms.editProfile,o=document.forms.editAvatar,c=document.querySelector(".profile__edit-button"),r=document.querySelector(".profile__add-button"),a=(document.querySelector(".popup__save-button"),document.querySelector(".popup_card-add")),u=document.forms.addCard,i=document.querySelector(".element__list"),l=document.querySelector(".popup_card"),s=l.querySelector(".popup__image"),d=l.querySelector(".figure__image-caption"),p=n.elements.name,f=n.elements.occupation,_=o.elements.name,m=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),v=u.elements.name,b=u.elements.link,y=document.querySelector(".profile__image"),g=document.querySelector(".popup__avatar");function S(e){return e.ok?e.json():Promise.reject(e)}function L(e,t){e.textContent=t}var q={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"189ba188-4e08-47fa-b661-1a41b634616c","Content-Type":"application/json"}};function k(){return fetch("".concat(q.baseUrl,"/users/me"),{headers:q.headers}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))}function E(e){s.src=e.src,s.alt=e.alt,d.textContent=e.alt,C(l)}function C(e){e.classList.add("popup_opened")}function x(e){e.classList.remove("popup_opened")}function A(e,t,n,o,c,r){var a=document.querySelector("#element_add").content.querySelector(".element").cloneNode(!0),u=a.querySelector(".element__title"),i=a.querySelector(".element__image"),l=a.querySelector(".element__like-count"),s=a.querySelector(".element__like-button"),d=a.querySelector(".element__delete-button");return r||d.remove(),d.addEventListener("click",(function(e){var t;(t=i.id,fetch("".concat(q.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:q.headers}).then(S).catch((function(e){console.log(e)}))).then((function(t){e.target.closest(".element").remove()})).catch((function(e){console.log(e)}))})),s.addEventListener("click",(function(e){var t;s.classList.contains("element__like-button_active")?((t=i.id,fetch("".concat(q.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:q.headers}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))).then().catch((function(e){console.log(e)})),s.classList.remove("element__like-button_active"),l.textContent=Number(l.textContent)-1):(function(e){return fetch("".concat(q.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:q.headers}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))}(i.id).then().catch((function(e){console.log(e)})),s.classList.add("element__like-button_active"),l.textContent=Number(l.textContent)+1)})),c&&s.classList.add("element__like-button_active"),u.textContent=e,i.src=t,i.alt=e,i.id=o,i.addEventListener("click",(function(e){return E(e.target)})),l.textContent=n,a}e.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup__close-button")&&x(e),t.target.classList.contains("popup")&&x(e)})),e.addEventListener("keydown",(function(t){"Escape"===t.key&&x(e)})),e.addEventListener("submit",(function(e){e.preventDefault();var n=e.target.querySelector(".popup__save-button");return function(e){e.textContent="Сохранение..."}(n),e.target.closest(".popup_card-add")?function(e){var t,n;(t=v,n=b,fetch("".concat(q.baseUrl,"/cards"),{method:"POST",headers:q.headers,body:JSON.stringify({name:t.value,link:n.value})}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))).then((function(t){var n=A(t.name,t.link,0,t._id,!1,!0);i.prepend(n),L(e,"Создать"),x(a),u.reset()})).catch((function(e){console.log(e)}))}(n):e.target.closest(".popup__avatar")?function(e){var t;(t=_,fetch("".concat(q.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:q.headers,body:JSON.stringify({avatar:t.value})}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))).then((function(t){L(e,"Сохранить"),y.style.backgroundImage="url(".concat(_.value),x(g)})).catch((function(e){console.log(e)}))}(n):function(e){(function(e,t){return fetch("".concat(q.baseUrl,"/users/me"),{method:"PATCH",headers:q.headers,body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return S(e)})).catch((function(e){console.log(e)}))})(p,f).then((function(n){L(e,"Сохранить"),m.textContent=p.value,h.textContent=f.value,x(t)})).catch((function(e){console.log(e)}))}(n)}))}));var U=function(e,t,n){var o=e.querySelector(".popup__input-".concat(t.name));t.classList.add("popup__input-field_error"),o.textContent=n,o.classList.add("popup__input-message_visible")},T=function(e,t){!function(e){return e.some((function(e){return 0===e.value.length||e.classList.contains("popup__input-field_error")}))}(e)?(t.classList.add("popup__save-button_active"),t.classList.remove("popup__save-button_disabled"),t.removeAttribute("disabled")):(t.classList.remove("popup__save-button_active"),t.classList.add("popup__save-button_disabled"),t.setAttribute("disabled",!0))};y.addEventListener("click",(function(e){C(g)})),c.addEventListener("click",(function(){p.value=m.textContent,f.value=h.textContent,C(t)})),k().then((function(e){y.style.backgroundImage="url(".concat(e.avatar),m.textContent=e.name,h.textContent=e.about})).catch((function(e){console.log(e)})),r.addEventListener("click",(function(){return C(a)})),k().then((function(e){fetch("".concat(q.baseUrl,"/cards"),{headers:q.headers}).then((function(e){return S(e)})).catch((function(e){console.log(e)})).then((function(t){t.forEach((function(t){var n=t.owner._id===e._id,o=!1;t.likes.forEach((function(t){t._id!=e._id||(o=!0)}));var c=A(t.name,t.link,t.likes.length,t._id,o,n);i.append(c)}))}))})).catch((function(e){console.log(e)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){!function(e){var t=Array.from(e.querySelectorAll(".popup__input-field")),n=e.querySelector(".popup__save-button");T(t,n),t.forEach((function(o){o.addEventListener("input",(function(){!function(e,t){t.validity.patternMismatch?U(e,t,t.dataset.errorMessage):t.validity.valid?function(e,t){var n=e.querySelector(".popup__input-".concat(t.name));t.classList.remove("popup__input-field_error"),n.classList.remove("popup__input-message_visible")}(e,t):U(e,t,t.validationMessage)}(e,o),T(t,n)}))}))}(e)}))})();