(()=>{"use strict";var e={popupForm:".popup__form",popupInput:".popup__input-field",popupInputError:"popup__input-field_error",popupInputMessageVisible:"popup__input-message_visible",popupSaveButton:".popup__save-button",popupSaveButtonActive:"popup__save-button_active",popupSaveButtonDisabled:"popup__save-button_disabled"},t=document.querySelectorAll(".popup"),n=document.querySelector(".popup_profile-edit"),o=document.forms.editProfile,c=document.forms.editAvatar,r=document.querySelector(".profile__edit-button"),u=document.querySelector(".profile__add-button"),a=(document.querySelector(".popup__save-button"),document.querySelector(".popup_card-add")),i=document.forms.addCard,s=document.querySelector(".element__list"),l=document.querySelector(".popup_card"),p=l.querySelector(".popup__image"),d=l.querySelector(".figure__image-caption"),f=o.elements.name,m=o.elements.occupation,v=c.elements.name,_=document.querySelector(".profile__name"),h=document.querySelector(".profile__description"),b=i.elements.name,y=i.elements.link,g=document.querySelector(".profile__image"),S=document.querySelector(".popup__avatar"),L=function(e,t,n,o){var c=e.querySelector(".popup__input-".concat(t.name));t.classList.add(o.popupInputError),c.textContent=n,c.classList.add(o.popupInputMessageVisible)},q=function(e,t,n){!function(e,t){return e.some((function(e){return 0===e.value.length||e.classList.contains(t.popupInputError)}))}(e,n)?(t.classList.add(n.popupSaveButtonActive),t.classList.remove(n.popupSaveButtonDisabled),t.removeAttribute("disabled")):(t.classList.remove(n.popupSaveButtonActive),t.classList.add(n.popupSaveButtonDisabled),t.setAttribute("disabled",!0))};function E(e,t){e.textContent=t}function k(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var C={baseUrl:"https://nomoreparties.co/v1/plus-cohort-19",headers:{authorization:"189ba188-4e08-47fa-b661-1a41b634616c","Content-Type":"application/json"}};function x(){return fetch("".concat(C.baseUrl,"/users/me"),{headers:C.headers}).then((function(e){return k(e)})).catch((function(e){console.log(e)}))}function A(e){p.src=e.src,p.alt=e.alt,d.textContent=e.alt,I(l)}function I(e){e.classList.add("popup_opened"),document.addEventListener("keydown",B)}function U(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",B)}function B(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&U(t)}}function T(e,t,n,o,c,r){var u=document.querySelector("#element_add").content.querySelector(".element").cloneNode(!0),a=u.querySelector(".element__title"),i=u.querySelector(".element__image"),s=u.querySelector(".element__like-count"),l=u.querySelector(".element__like-button"),p=u.querySelector(".element__delete-button");return i.id=o,r||p.remove(),p.addEventListener("click",(function(e){var t;(t=i.id,fetch("".concat(C.baseUrl,"/cards/").concat(t),{method:"DELETE",headers:C.headers}).then(k).catch((function(e){console.log(e)}))).then((function(t){t&&e.target.closest(".element").remove()})).catch((function(e){console.log(e)}))})),l.addEventListener("click",(function(e){var t;l.classList.contains("element__like-button_active")?(t=i.id,fetch("".concat(C.baseUrl,"/cards/likes/").concat(t),{method:"DELETE",headers:C.headers}).then((function(e){return k(e)})).catch((function(e){console.log(e)}))).then((function(e){e&&(l.classList.remove("element__like-button_active"),s.textContent=Number(s.textContent)-1)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(C.baseUrl,"/cards/likes/").concat(e),{method:"PUT",headers:C.headers}).then((function(e){return k(e)})).catch((function(e){console.log(e)}))}(i.id).then((function(e){e&&(l.classList.add("element__like-button_active"),s.textContent=Number(s.textContent)+1)})).catch((function(e){console.log(e)}))})),c&&l.classList.add("element__like-button_active"),a.textContent=e,i.src=t,i.alt=e,i.addEventListener("click",(function(e){return A(e.target)})),s.textContent=n,u}g.addEventListener("click",(function(e){I(S)})),r.addEventListener("click",(function(){f.value=_.textContent,m.value=h.textContent,I(n)})),x().then((function(e){e&&(g.style.backgroundImage="url(".concat(e.avatar),_.textContent=e.name,h.textContent=e.about)})).catch((function(e){console.log(e)})),t.forEach((function(e){e.addEventListener("click",(function(t){t.target.classList.contains("popup__close-button")&&U(e),t.target.classList.contains("popup")&&U(e)}))})),u.addEventListener("click",(function(){return I(a)})),document.addEventListener("submit",(function(t){t.preventDefault();var o=t.target.querySelector(e.popupSaveButton);if(o)return function(e){e.textContent="Сохранение..."}(o),t.target.closest(".popup_card-add")?function(e){var t,n;(t=b,n=y,fetch("".concat(C.baseUrl,"/cards"),{method:"POST",headers:C.headers,body:JSON.stringify({name:t.value,link:n.value})}).then((function(e){return k(e)})).catch((function(e){console.log(e)}))).then((function(t){if(t){var n=T(t.name,t.link,0,t._id,!1,!0);return s.prepend(n),E(e,"Создать"),U(a),void i.reset()}})).catch((function(e){console.log(e)}))}(o):t.target.closest(".popup__avatar")?function(e){var t;(t=v,fetch("".concat(C.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:C.headers,body:JSON.stringify({avatar:t.value})}).then((function(e){return k(e)})).catch((function(e){console.log(e)}))).then((function(t){t&&(E(e,"Сохранить"),g.style.backgroundImage="url(".concat(v.value),U(S),c.reset())})).catch((function(e){console.log(e)}))}(o):function(e){(function(e,t){return fetch("".concat(C.baseUrl,"/users/me"),{method:"PATCH",headers:C.headers,body:JSON.stringify({name:e.value,about:t.value})}).then((function(e){return k(e)})).catch((function(e){console.log(e)}))})(f,m).then((function(t){t&&(E(e,"Сохранить"),_.textContent=f.value,h.textContent=m.value,U(n))})).catch((function(e){console.log(e)}))}(o)})),x().then((function(e){e&&fetch("".concat(C.baseUrl,"/cards"),{headers:C.headers}).then((function(e){return k(e)})).catch((function(e){console.log(e)})).then((function(t){t.forEach((function(t){var n=t.owner._id===e._id,o=!1;t.likes.forEach((function(t){t._id!=e._id||(o=!0)}));var c=T(t.name,t.link,t.likes.length,t._id,o,n);s.append(c)}))}))})).catch((function(e){console.log(e)})),function(e){Array.from(document.querySelectorAll(e.popupForm)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.popupInput)),o=e.querySelector(t.popupSaveButton);q(n,o,t),e.addEventListener("reset",(function(){setTimeout((function(){q(n,o,t)}),0)})),n.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?L(e,t,t.dataset.errorMessage,n):t.validity.valid?function(e,t,n){var o=e.querySelector(".popup__input-".concat(t.name));t.classList.remove(n.popupInputError),o.classList.remove(n.popupInputMessageVisible)}(e,t,n):L(e,t,t.validationMessage,n)}(e,c,t),q(n,o,t)}))}))}(t,e)}))}(e)})();